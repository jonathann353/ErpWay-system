<!-- pagamento_form.html -->
<form id="formPagamentoPix" class="space-y-4">
    {% csrf_token %}
    <input name="nome" placeholder="Nome" required class="border p-2 w-full">
    <input name="email" placeholder="Email" type="email" required class="border p-2 w-full">
    <select name="identificationType" class="border p-2 w-full">
        <option value="CPF">CPF</option>
        <option value="CNPJ">CNPJ</option>
    </select>
    <input name="identificationNumber" placeholder="NÃºmero do documento" required class="border p-2 w-full">
    <input name="valor" placeholder="Valor" value="100" required class="border p-2 w-full">

    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded w-full">Gerar PIX</button>
</form>

<script>
document.getElementById('formPagamentoPix').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
    
    const response = await fetch("{% url 'criar_pagamento_pix' cod_aluno=cod_aluno %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": csrfToken,
        },
        body: formData,
    });

    const html = await response.text();

    // Exibe o QRCode dentro do modal
    const modalQr = document.createElement("div");
    modalQr.innerHTML = html;
    document.body.appendChild(modalQr);

    // Esconde modal anterior
    document.getElementById('modalPagamento').classList.add('hidden');
});
</script>