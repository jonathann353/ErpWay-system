<!-- Modal QRCode PIX -->
<div id="modalQrCode" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
  aria-hidden="true">
  <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 relative">
    <button id="fecharModalQrCode"
      class="absolute top-4 right-4 text-gray-500 hover:text-red-600 text-2xl font-bold focus:outline-none"
      aria-label="Fechar" type="button">
      ✕
    </button>

    <h2 class="text-2xl font-semibold mb-5 text-gray-900">Pagamento via PIX</h2>

    {% if qr_code %}
    <img src="data:image/png;base64,{{ qr_code_base64 }}" alt="QRCode PIX" class="w-60 h-60 mx-auto mb-6" />
    <p class="text-gray-600 text-sm mb-2 text-center">Ou copie e cole o código:</p>

    <div class="relative">
      <textarea id="codigoPix" readonly
        class="w-full p-3 border border-gray-300 rounded-md text-xs font-mono resize-none focus:outline-indigo-500 transition"
        rows="3" onclick="this.select()">{{ qr_code }}</textarea>
      <button onclick="copiarCodigoPix()"
        class="absolute top-1 right-1 bg-indigo-600 text-white text-xs px-2 py-1 rounded hover:bg-indigo-700"
        type="button">Copiar</button>
      <p class="mt-4 text-center text-sm text-gray-700">
        Status do pagamento: <strong>{{ status }}</strong>
      </p>
      <p class="text-center text-sm text-gray-700">
        Valor: <strong>R$ {{ valor }}</strong>
      </p>
      {% else %}
      <p class="text-center text-gray-500">Nenhum QRCode disponível.</p>
      {% endif %}
    </div>
  </div>
</div>
<script>
function copiarCodigoPix() {
  const codigo = document.getElementById("codigoPix");
  codigo.select();
  codigo.setSelectionRange(0, 99999); // Mobile
  document.execCommand("copy");

  alert("Código PIX copiado com sucesso!");
}
async function verificarStatusPagamento() {
  const paymentId = "{{ pagamento_id|default:None }}";  // ou mp_payment_id

  if (!paymentId) return;

  try {
    const response = await fetch(`/pagamento/atualizar/${paymentId}/?cod_aluno={{ cod_aluno }}`);
    if (response.ok) {
      const texto = await response.text();
      if (texto.includes("approved")) {
        window.location.href = "{% url 'pagamento_sucesso' %}";
      }
    }
  } catch (err) {
    console.error("Erro ao verificar status:", err);
  }
}

// Consulta o status a cada 10 segundos
setInterval(verificarStatusPagamento, 10000);
</script>